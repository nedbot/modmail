datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Thread {
  id Int @id @default(autoincrement()) @db.Integer

  status     ThreadStatus    @default(OPEN)
  channel_id String?         @unique @db.VarChar(20)
  user_id    String          @db.VarChar(20)
  messages   ThreadMessage[]

  @@map(name: "threads")
}

model ThreadMessage {
  id Int @id @default(autoincrement()) @db.Integer

  type        ThreadMessageType
  content     String            @db.VarChar(2000)
  attachments Json[]

  thread_id Int    @db.Integer
  thread    Thread @relation(fields: [thread_id], references: [id])

  @@map(name: "thread_messages")
}

model ThreadUser {
  id String @id @db.VarChar(20)

  blocked        Boolean @default(false)
  blocked_reason String? @db.VarChar(2000)

  @@map(name: "thread_users")
}

enum ThreadStatus {
  OPEN
  CLOSED
}

enum ThreadMessageType {
  USER
  MOD
  CHAT
  COMMAND
}
